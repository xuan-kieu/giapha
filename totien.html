<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>T·ªï ti√™n - Gia Ph·∫£ ƒê·∫°i Vi·ªát</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" href="css/chung.css">
</head>
<body>
    <div class="khung-trang">
        <div class="thanh-ben" id="thanhBen">
            <div>
                <h2>Gia Ph·∫£ ƒê·∫°i Vi·ªát</h2>
                <button class="nut-hamburger" onclick="toggleMobileMenu()" aria-label="M·ªü/ƒë√≥ng menu">
                    <i class="fa-solid fa-bars"></i>
                </button>
                <nav id="menuDieuHuong">
                    <ul>
                        <li><a href="trangcanhan.html">Trang c√° nh√¢n</a></li>
                        <li class="co-menu-con">
                            <span onclick="toggleSubmenu('menuConPhaHe')" role="button" aria-expanded="false">Ph·∫£ h·ªá <span class="mui-ten">&#9662;</span></span>
                            <ul class="menu-con" id="menuConPhaHe">
                                <li><a href="quanlythanhvien.html">Qu·∫£n l√Ω th√†nh vi√™n</a></li>
                                <li><a href="caygiapha.html">C√¢y gia ph·∫£</a></li>
                            </ul>
                        </li>
                        <li class="co-menu-con">
                            <span onclick="toggleSubmenu('menuConPhaKy')" role="button" aria-expanded="true">Ph·∫£ k√Ω <span class="mui-ten">&#9662;</span></span>
                            <ul class="menu-con hien-thi" id="menuConPhaKy">
                                <li><a href="nhathoto.html">Nh√† th·ªù t·ªï</a></li>
                                <li><a href="lichsu.html">L·ªãch s·ª≠</a></li>
                                <li><a href="totien.html">T·ªï ti√™n</a></li>
                                <li><a href="truyenthong.html">Truy·ªÅn th·ªëng</a></li>
                            </ul>
                        </li>
                        <li><a href="congduc.html">C√¥ng ƒë·ª©c</a></li>
                        <li><a href="ngoaipha.html">Ngo·∫°i ph·∫£</a></li>
                        <li><a href="hinhanh.html">H√¨nh ·∫£nh</a></li>
                    </ul>
                </nav>
            </div>
            <div class="khu-vuc-ngu-dung" onclick="toggleDropdown()" role="button" aria-haspopup="true" aria-expanded="false">
                <div class="hop-nguoi-dung">
                    <img src="assets/bg.jpg" alt="·∫¢nh ƒë·∫°i di·ªán">
                    <div class="thong-tin">
                        <strong>user</strong>
                    </div>
                </div>
                <div class="menu-tha-xuong" id="userDropdown">
                    <p onclick="logout()">ƒêƒÉng xu·∫•t</p>
                </div>
            </div>
        </div>

        <div class="noi-dung-chinh">
            <div class="banner-tieu-de-trang">
                <h1>T·ªï ti√™n</h1>
            </div>

            <div class="khu-vuc-dieu-khien">
                <button class="nut-bam-phu" onclick="moModalToTien('them')">
                    <i class="fa-solid fa-plus"></i> Th√™m t·ªï ti√™n
                </button>
                <div class="khung-tim-kiem">
                    <input type="text" class="input-tim-kiem" id="inputTimToTien" placeholder="Nh·∫≠p ID ho·∫∑c T√™n t·ªï ti√™n...">
                    <button class="nut-tim-kiem" onclick="timToTien()">
                        <i class="fa-solid fa-magnifying-glass"></i> T√¨m
                    </button>
                </div>
            </div>

            <div id="thongBaoKhongKetQua" class="thong-bao-loi" style="display: none;">Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£ n√†o.</div>

            <div class="khung-bang">
                <table class="bang-chung">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>T√™n</th>
                            <th>M√¥ t·∫£</th>
                            <th class="cot-thao-tac">Thao t√°c</th>
                        </tr>
                    </thead>
                    <tbody id="noiDungBangToTien">
                        </tbody>
                </table>
            </div>

        </div>
    </div>

    <div id="toastNotification" class="thong-bao-nho">
        <i class="fa-solid" id="toastIcon"></i>
        <span id="toastMessage"></span>
    </div>

    <div id="modalToTien" class="modal">
        <div class="modal-noi-dung">
            <button class="nut-dong-modal" onclick="dongModalToTien()"><i class="fa-solid fa-xmark"></i></button>
            <h2 id="tieuDeModal">Th√™m T·ªï ti√™n m·ªõi</h2>
            <form id="formToTien">
                <input type="hidden" id="idToTien">
                <input type="text" id="tenToTien" class="input-truong" placeholder="T√™n T·ªï ti√™n" required>
                <textarea id="moTaToTien" class="input-truong" placeholder="M√¥ t·∫£"></textarea>
                <div class="modal-buttons">
                    <button type="submit" class="nut-bam">Th√™m T·ªï ti√™n</button>
                </div>
            </form>
        </div>
    </div>

    <div id="modalXacNhanXoa" class="modal">
        <div class="modal-noi-dung modal-confirm">
            <p>B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a t·ªï ti√™n n√†y kh√¥ng?</p>
            <div class="khung-nut-confirm">
                <button class="nut-huy-confirm" onclick="dongModalXacNhanXoa()">H·ªßy</button>
                <button class="nut-bam nut-xoa-confirm" id="nutXacNhanXoa">X√≥a</button>
            </div>
        </div>
    </div>

 <script>
const API_URL = "https://682ed083746f8ca4a47e6bb5.mockapi.io/user"; // üîÅ ƒê·ªïi th√†nh MockAPI th·∫≠t
let idToTienDangXoa = null;

// --- Sidebar & Dropdown ---
function toggleDropdown() {
    const dropdown = document.getElementById('userDropdown');
    dropdown.classList.toggle('hien-thi');
    const khuVucNguDung = document.querySelector('.khu-vuc-ngu-dung');
    khuVucNguDung.setAttribute('aria-expanded', dropdown.classList.contains('hien-thi'));
}

function logout() {
    alert('ƒêƒÉng xu·∫•t th√†nh c√¥ng!');
    window.location.href = 'dangnhap.html';
}

function toggleSubmenu(id) {
    const submenu = document.getElementById(id);
    const parentSpan = submenu.previousElementSibling;
    submenu.classList.toggle('hien-thi');
    parentSpan.setAttribute('aria-expanded', submenu.classList.contains('hien-thi'));
}

function toggleMobileMenu() {
    const menu = document.getElementById('menuDieuHuong');
    const thanhBen = document.getElementById('thanhBen');
    menu.classList.toggle('hien-thi');
    thanhBen.classList.toggle('menu-mo');
}

window.onclick = function(event) {
    if (!event.target.matches('.khu-vuc-ngu-dung, .khu-vuc-ngu-dung *')) {
        const dropdowns = document.getElementsByClassName('menu-tha-xuong');
        for (let i = 0; i < dropdowns.length; i++) {
            const openDropdown = dropdowns[i];
            if (openDropdown.classList.contains('hien-thi')) {
                openDropdown.classList.remove('hien-thi');
                document.querySelector('.khu-vuc-ngu-dung').setAttribute('aria-expanded', 'false');
            }
        }
    }
    if (event.target === document.getElementById('modalToTien')) dongModalToTien();
    if (event.target === document.getElementById('modalXacNhanXoa')) dongModalXacNhanXoa();
};

function hienThiToast(message, type = 'thanh-cong') {
    const toast = document.getElementById('toastNotification');
    const toastMessage = document.getElementById('toastMessage');
    const toastIcon = document.getElementById('toastIcon');
    toastMessage.textContent = message;
    toast.className = 'thong-bao-nho hien-thi';
    toastIcon.className = 'fa-solid';
    if (type === 'thanh-cong') toastIcon.classList.add('fa-check-circle');
    else toastIcon.classList.add('fa-times-circle');
    toast.classList.add(type);
    setTimeout(() => toast.classList.remove('hien-thi', 'thanh-cong', 'that-bai'), 3000);
}

// --- Modal Th√™m/S·ª≠a ---
const modalToTien = document.getElementById('modalToTien');
const formToTien = document.getElementById('formToTien');
const tieuDeModal = document.getElementById('tieuDeModal');
const idToTienInput = document.getElementById('idToTien');
const tenToTienInput = document.getElementById('tenToTien');
const moTaToTienInput = document.getElementById('moTaToTien');
const nutSubmitModal = document.querySelector('#formToTien .nut-bam');

function moModalToTien(hanhDong, id = null) {
    modalToTien.classList.add('hien-thi');
    formToTien.reset();
    if (hanhDong === 'them') {
        tieuDeModal.textContent = 'Th√™m T·ªï ti√™n m·ªõi';
        idToTienInput.value = '';
        nutSubmitModal.textContent = 'Th√™m T·ªï ti√™n';
    } else if (hanhDong === 'sua' && id !== null) {
        tieuDeModal.textContent = 'Ch·ªânh s·ª≠a T·ªï ti√™n';
        nutSubmitModal.textContent = 'L∆∞u thay ƒë·ªïi';
        fetch(`${API_URL}/${id}`).then(res => res.json()).then(toTien => {
            idToTienInput.value = toTien.id;
            tenToTienInput.value = toTien.totien_name;
            moTaToTienInput.value = toTien.totien_des;
        }).catch(() => {
            hienThiToast('Kh√¥ng t√¨m th·∫•y t·ªï ti√™n ƒë·ªÉ ch·ªânh s·ª≠a!', 'that-bai');
            dongModalToTien();
        });
    }
}

function dongModalToTien() {
    modalToTien.classList.remove('hien-thi');
}

formToTien.addEventListener('submit', async function(event) {
    event.preventDefault();
    const id = idToTienInput.value;
    const totien_name = tenToTienInput.value.trim();
    const totien_des = moTaToTienInput.value.trim();
    if (!totien_name) {
        hienThiToast('T√™n t·ªï ti√™n kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng!', 'that-bai');
        return;
    }
    const data = { totien_name, totien_des };
    try {
        if (id) {
            await fetch(`${API_URL}/${id}`, {
                method: "PUT",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(data)
            });
            hienThiToast('C·∫≠p nh·∫≠t t·ªï ti√™n th√†nh c√¥ng!');
        } else {
            await fetch(API_URL, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(data)
            });
            hienThiToast('Th√™m t·ªï ti√™n m·ªõi th√†nh c√¥ng!');
        }
        dongModalToTien();
        taiDanhSachToTien();
    } catch {
        hienThiToast('L·ªói k·∫øt n·ªëi MockAPI!', 'that-bai');
    }
});

// --- Modal x√°c nh·∫≠n x√≥a ---
function moModalXacNhanXoa(id) {
    idToTienDangXoa = id;
    document.getElementById('modalXacNhanXoa').classList.add('hien-thi');
}
function dongModalXacNhanXoa() {
    idToTienDangXoa = null;
    document.getElementById('modalXacNhanXoa').classList.remove('hien-thi');
}

document.getElementById('nutXacNhanXoa').addEventListener('click', async () => {
    if (!idToTienDangXoa) return;
    try {
        await fetch(`${API_URL}/${idToTienDangXoa}`, { method: "DELETE" });
        hienThiToast('X√≥a t·ªï ti√™n th√†nh c√¥ng!');
        taiDanhSachToTien();
        dongModalXacNhanXoa();
    } catch {
        hienThiToast('Kh√¥ng th·ªÉ x√≥a t·ªï ti√™n!', 'that-bai');
    }
});

// --- Hi·ªÉn th·ªã danh s√°ch ---
async function taiDanhSachToTien() {
    try {
        const res = await fetch(API_URL);
        const danhSach = await res.json();
        renderDanhSachToTien(danhSach);
    } catch {
        hienThiToast('Kh√¥ng th·ªÉ t·∫£i danh s√°ch t·ªï ti√™n!', 'that-bai');
    }
}

function renderDanhSachToTien(list) {
    const noiDungBangToTien = document.getElementById('noiDungBangToTien');
    const thongBaoKhongKetQua = document.getElementById('thongBaoKhongKetQua');
    noiDungBangToTien.innerHTML = '';
    if (list.length === 0) {
        thongBaoKhongKetQua.style.display = 'block';
        return;
    } else {
        thongBaoKhongKetQua.style.display = 'none';
    }
    list.forEach(toTien => {
        const row = noiDungBangToTien.insertRow();
        row.innerHTML = `
            <td data-label="ID">${toTien.id}</td>
            <td data-label="T√™n">${toTien.totien_name}</td>
            <td data-label="M√¥ t·∫£">${toTien.totien_des}</td>
            <td class="cot-thao-tac" data-label="Thao t√°c">
                <button class="nut-thao-tac nut-sua" onclick="moModalToTien('sua', '${toTien.id}')">
                    <i class="fa-solid fa-pencil"></i> S·ª≠a
                </button>
                <button class="nut-thao-tac nut-xoa" onclick="moModalXacNhanXoa('${toTien.id}')">
                    <i class="fa-solid fa-trash-can"></i> X√≥a
                </button>
            </td>`;
    });
}

function timToTien() {
    const searchTerm = document.getElementById('inputTimToTien').value.toLowerCase();
    fetch(API_URL)
        .then(res => res.json())
        .then(data => {
            const ketQua = data.filter(toTien =>
                toTien.totien_name.toLowerCase().includes(searchTerm) ||
                String(toTien.id).includes(searchTerm)
            );
            renderDanhSachToTien(ketQua);
        })
        .catch(() => hienThiToast("Kh√¥ng th·ªÉ t√¨m ki·∫øm!", 'that-bai'));
}

// --- Kh·ªüi t·∫°o khi trang t·∫£i ---
document.addEventListener('DOMContentLoaded', taiDanhSachToTien);
</script>
</body>
</html>