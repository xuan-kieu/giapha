<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n l√Ω th√†nh vi√™n - Gia Ph·∫£ ƒê·∫°i Vi·ªát</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <link rel="stylesheet" href="css/chung.css">
    <link rel="stylesheet" href="css/quanlythanhvien.css">

</head>
<body>
    <div class="khung-trang">
        <div class="thanh-ben" id="thanhBen">
            <div>
                <h2>Gia Ph·∫£ ƒê·∫°i Vi·ªát</h2>
                <button class="nut-hamburger" onclick="toggleMobileMenu()" aria-label="M·ªü/ƒë√≥ng menu">
                    <i class="fa-solid fa-bars"></i>
                </button>
                <nav id="menuDieuHuong">
                    <ul>
                        <li><a href="trangcanhan.html">Trang c√° nh√¢n</a></li>
                        <li class="co-menu-con">
                            <span onclick="toggleSubmenu('menuConPhaHe')" role="button" aria-expanded="false">Ph·∫£ h·ªá <span class="mui-ten">&#9662;</span></span>
                            <ul class="menu-con" id="menuConPhaHe">
                                <li><a href="quanlythanhvien.html">Qu·∫£n l√Ω th√†nh vi√™n</a></li>
                                <li><a href="caygiapha.html">C√¢y gia ph·∫£</a></li>
                            </ul>
                        </li>
                        <li class="co-menu-con">
                            <span onclick="toggleSubmenu('menuConPhaKy')" role="button" aria-expanded="false">Ph·∫£ k√Ω <span class="mui-ten">&#9662;</span></span>
                            <ul class="menu-con" id="menuConPhaKy">
                                <li><a href="nhathoto.html">Nh√† th·ªù t·ªï</a></li>
                                <li><a href="lichsu.html">L·ªãch s·ª≠</a></li>
                                <li><a href="totien.html">T·ªï ti√™n</a></li>
                                <li><a href="truyenthong.html">Truy·ªÅn th·ªëng</a></li>
                            </ul>
                        </li>
                        <li><a href="congduc.html">C√¥ng ƒë·ª©c</a></li>
                        <li><a href="ngoaipha.html">Ngo·∫°i ph·∫£</a></li>
                        <li><a href="hinhanh.html">H√¨nh ·∫£nh</a></li>
                    </ul>
                </nav>
            </div>
            <div class="khu-vuc-ngu-dung" onclick="toggleDropdown()" role="button" aria-haspopup="true" aria-expanded="false">
                <div class="hop-nguoi-dung">
                    <img src="assets/bg.jpg" alt="·∫¢nh ƒë·∫°i di·ªán">
                    <div class="thong-tin">
                        <strong>user</strong>
                    </div>
                </div>
                <div class="menu-tha-xuong" id="userDropdown">
                    <p onclick="logout()">ƒêƒÉng xu·∫•t</p>
                </div>
            </div>
        </div>

        <div class="noi-dung-chinh">
            <div class="banner-tieu-de-trang">
                <h1>Qu·∫£n l√Ω th√†nh vi√™n</h1>
            </div>

            <div class="khu-vuc-dieu-khien">
                <button class="nut-bam-phu" onclick="openAddMemberModal()">
                    <i class="fa-solid fa-plus"></i> Th√™m th√†nh vi√™n
                </button>
                <div class="khung-tim-kiem">
                    <input type="text" class="input-tim-kiem" placeholder="Nh·∫≠p ID ho·∫∑c T√™n" id="searchInput">
                    <button class="nut-tim-kiem" onclick="searchMembers()">T√¨m ki·∫øm</button>
                </div>
                <div id="noResultsMessage" class="thong-bao-loi">Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£</div>
            </div>

            <div class="khung-bang">
                <table class="bang-chung">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>T√™n</th>
                            <th>Email</th>
                            <th>Vai tr√≤</th>
                            <th>Tr·∫°ng th√°i</th>
                            <th>Thao t√°c</th>
                        </tr>
                    </thead>
                    <tbody id="memberTableBody">
                        </tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="toastNotification" class="thong-bao-nho">
        <i class="fa-solid" id="toastIcon"></i>
        <span id="toastMessage"></span>
    </div>


    <div id="addMemberModal" class="modal">
        <div class="modal-noi-dung">
            <button class="nut-dong-modal" onclick="closeAddMemberModal()"><i class="fa-solid fa-xmark"></i></button>
            <h2>Th√™m th√†nh vi√™n</h2>
            <input type="text" class="input-truong" placeholder="ID" id="addMemberId">
            <input type="text" class="input-truong" placeholder="T√™n" id="addMemberName">
            <input type="email" class="input-truong" placeholder="Email" id="addMemberEmail">
            <select class="input-truong" id="addMemberRole">
                <option value="Admin">Admin</option>
                <option value="Ng∆∞·ªùi d√πng">Ng∆∞·ªùi d√πng</option>
            </select>
            <select class="input-truong" id="addMemberStatus">
                <option value="S·ªëng">S·ªëng</option>
                <option value="ƒê√£ m·∫•t">ƒê√£ m·∫•t</option>
            </select>
            <button class="nut-bam" onclick="addMember()">X√°c nh·∫≠n</button>
        </div>
    </div>

    <div id="editMemberModal" class="modal">
        <div class="modal-noi-dung">
            <button class="nut-dong-modal" onclick="closeEditMemberModal()"><i class="fa-solid fa-xmark"></i></button>
            <h2>C·∫≠p nh·∫≠t th√†nh vi√™n</h2>
            <input type="text" class="input-truong" placeholder="ID" id="editMemberId" readonly>
            <input type="text" class="input-truong" placeholder="T√™n" id="editMemberName">
            <input type="email" class="input-truong" placeholder="Email" id="editMemberEmail">
            <select class="input-truong" id="editMemberRole">
                <option value="Admin">Admin</option>
                <option value="Ng∆∞·ªùi d√πng">Ng∆∞·ªùi d√πng</option>
            </select>
            <select class="input-truong" id="editMemberStatus">
                <option value="S·ªëng">S·ªëng</option>
                <option value="ƒê√£ m·∫•t">ƒê√£ m·∫•t</option>
            </select>
            <button class="nut-bam" onclick="updateMember()">X√°c nh·∫≠n</button>
        </div>
    </div>

    <div id="deleteConfirmModal" class="modal">
        <div class="modal-noi-dung modal-confirm">
            <button class="nut-dong-modal" onclick="closeDeleteConfirmModal()"><i class="fa-solid fa-xmark"></i></button>
            <p>B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a th√†nh vi√™n n√†y kh√¥ng?</p>
            <div class="khung-nut-confirm">
                <button class="nut-bam nut-xoa-confirm" onclick="confirmDeleteMember()">X√≥a</button>
                <button class="nut-bam nut-huy-confirm" onclick="closeDeleteConfirmModal()">H·ªßy</button>
            </div>
        </div>
    </div>
<script>
const API_URL = "https://682ed083746f8ca4a47e6bb5.mockapi.io/user"; // üîÅ Thay b·∫±ng URL th·∫≠t
let memberToDeleteId = null;
let currentUserRole = 'Admin'; // Ho·∫∑c 'Ng∆∞·ªùi d√πng'

// ===== SIDEBAR & DROPDOWN =====
function toggleDropdown() {
    const box = document.getElementById("userDropdown");
    box.classList.toggle("hien-thi");
    const userArea = document.querySelector('.khu-vuc-ngu-dung');
    if (userArea) userArea.setAttribute('aria-expanded', box.classList.contains("hien-thi"));
}
function toggleSubmenu(id) {
    const menu = document.getElementById(id);
    const parentSpan = menu.previousElementSibling;
    const isExpanded = parentSpan.getAttribute('aria-expanded') === 'true';
    menu.classList.toggle("hien-thi");
    parentSpan.setAttribute('aria-expanded', !isExpanded);
}
function logout() {
    window.location.href = "dangnhap.html";
}
function toggleMobileMenu() {
    const menu = document.getElementById("menuDieuHuong");
    const sidebar = document.getElementById("thanhBen");
    menu.classList.toggle("hien-thi");
    sidebar.classList.toggle("menu-mo");
    document.querySelector('.nut-hamburger').setAttribute('aria-expanded', menu.classList.contains("hien-thi"));
}
document.addEventListener('click', function(event) {
    const sidebar = document.getElementById('thanhBen');
    const menu = document.getElementById('menuDieuHuong');
    const hamburger = document.querySelector('.nut-hamburger');
    const dropdown = document.getElementById('userDropdown');
    const userArea = document.querySelector('.khu-vuc-ngu-dung');

    if (!sidebar.contains(event.target) && !hamburger.contains(event.target) && menu.classList.contains("hien-thi")) {
        menu.classList.remove("hien-thi");
        sidebar.classList.remove("menu-mo");
        hamburger.setAttribute("aria-expanded", "false");
    }

    if (dropdown.classList.contains("hien-thi") && !userArea.contains(event.target) && !dropdown.contains(event.target)) {
        dropdown.classList.remove("hien-thi");
        userArea.setAttribute("aria-expanded", "false");
    }

    document.querySelectorAll('.co-menu-con span[aria-expanded="true"]').forEach(span => {
        const submenu = span.nextElementSibling;
        if (!submenu.contains(event.target) && !span.contains(event.target)) {
            submenu.classList.remove("hien-thi");
            span.setAttribute("aria-expanded", "false");
        }
    });
});

// ===== TOAST =====
function showToast(message, type = 'success') {
    const toast = document.getElementById('toastNotification');
    const toastIcon = document.getElementById('toastIcon');
    const toastMessage = document.getElementById('toastMessage');

    toast.classList.remove('thanh-cong', 'that-bai', 'hien-thi');
    toastIcon.className = 'fa-solid';
    toastMessage.textContent = message;

    if (type === 'success') {
        toast.classList.add('thanh-cong');
        toastIcon.classList.add('fa-check-circle');
    } else {
        toast.classList.add('that-bai');
        toastIcon.classList.add('fa-xmark-circle');
    }

    toast.classList.add('hien-thi');
    setTimeout(() => toast.classList.remove('hien-thi'), 3000);
}

// ===== MODALS =====
function openModal(id) {
    document.getElementById(id).classList.add('hien-thi');
}
function closeModal(id) {
    document.getElementById(id).classList.remove('hien-thi');
}
function openAddMemberModal() {
    document.getElementById('addMemberId').value = '';
    document.getElementById('addMemberName').value = '';
    document.getElementById('addMemberEmail').value = '';
    document.getElementById('addMemberRole').value = 'Ng∆∞·ªùi d√πng';
    document.getElementById('addMemberStatus').value = 'S·ªëng';
    openModal('addMemberModal');
}
function closeAddMemberModal() {
    closeModal('addMemberModal');
}
function closeEditMemberModal() {
    closeModal('editMemberModal');
}
function openDeleteConfirmModal(id) {
    memberToDeleteId = id;
    openModal('deleteConfirmModal');
}
function closeDeleteConfirmModal() {
    closeModal('deleteConfirmModal');
    memberToDeleteId = null;
}

// ===== MOCKAPI - CRUD =====
async function fetchMembers() {
    const res = await fetch(API_URL);
    return await res.json();
}
async function renderMembersTable(data = null) {
    const tableBody = document.getElementById('memberTableBody');
    tableBody.innerHTML = '';
    const noResultsMessage = document.getElementById('noResultsMessage');

    const members = data || await fetchMembers();
    noResultsMessage.style.display = members.length === 0 ? 'block' : 'none';

    members.forEach(member => {
        const row = `
            <tr>
                <td>${member.id}</td>
                <td>${member.name}</td>
                <td>${member.email}</td>
                <td>${member.role}</td>
                <td>${member.status}</td>
                <td>
                    <button onclick="openEditMemberModal('${member.id}')"><i class="fa fa-pen-to-square"></i></button>
                    <button onclick="openDeleteConfirmModal('${member.id}')"><i class="fa fa-trash-can"></i></button>
                </td>
            </tr>
        `;
        tableBody.innerHTML += row;
    });
}
async function addMember() {
    const member = {
        id: document.getElementById('addMemberId').value.trim(),
        name: document.getElementById('addMemberName').value.trim(),
        email: document.getElementById('addMemberEmail').value.trim(),
        role: document.getElementById('addMemberRole').value,
        status: document.getElementById('addMemberStatus').value
    };

    if (!member.id || !member.name || !member.email || !/\S+@\S+\.\S+/.test(member.email)) {
        showToast("Vui l√≤ng nh·∫≠p th√¥ng tin h·ª£p l·ªá!", "error");
        return;
    }

    await fetch(API_URL, {
        method: "POST",
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(member)
    });

    closeAddMemberModal();
    showToast("Th√™m th√†nh vi√™n th√†nh c√¥ng!");
    renderMembersTable();
}
async function openEditMemberModal(id) {
    const res = await fetch(`${API_URL}/${id}`);
    const member = await res.json();

    document.getElementById('editMemberId').value = member.id;
    document.getElementById('editMemberId').setAttribute('data-original-id', member.id);
    document.getElementById('editMemberName').value = member.name;
    document.getElementById('editMemberEmail').value = member.email;
    document.getElementById('editMemberRole').value = member.role;
    document.getElementById('editMemberStatus').value = member.status;

    openModal('editMemberModal');
}
async function updateMember() {
    const originalId = document.getElementById('editMemberId').getAttribute('data-original-id');
    const member = {
        id: document.getElementById('editMemberId').value.trim(),
        name: document.getElementById('editMemberName').value.trim(),
        email: document.getElementById('editMemberEmail').value.trim(),
        role: document.getElementById('editMemberRole').value,
        status: document.getElementById('editMemberStatus').value
    };

    if (!member.name || !member.email) {
        showToast("Vui l√≤ng ƒëi·ªÅn th√¥ng tin h·ª£p l·ªá!", "error");
        return;
    }

    await fetch(`${API_URL}/${originalId}`, {
        method: "PUT",
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(member)
    });

    closeEditMemberModal();
    showToast("C·∫≠p nh·∫≠t th√†nh vi√™n th√†nh c√¥ng!");
    renderMembersTable();
}
async function confirmDeleteMember() {
    if (!memberToDeleteId) {
        showToast("Kh√¥ng c√≥ th√†nh vi√™n ƒë·ªÉ x√≥a!", "error");
        return;
    }
    await fetch(`${API_URL}/${memberToDeleteId}`, { method: "DELETE" });
    closeDeleteConfirmModal();
    showToast("ƒê√£ x√≥a th√†nh vi√™n!");
    renderMembersTable();
}
async function searchMembers() {
    const keyword = document.getElementById('searchInput').value.trim().toLowerCase();
    const all = await fetchMembers();
    const result = all.filter(m =>
        m.id.toLowerCase().includes(keyword) ||
        m.name.toLowerCase().includes(keyword)
    );
    renderMembersTable(result);
}

// ===== INIT =====
document.addEventListener("DOMContentLoaded", () => {
    renderMembersTable();
});
</script>

</body>
</html>